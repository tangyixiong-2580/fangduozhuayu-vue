<template>
    <div class="Wholelist">
        <div class="wholelist-mook">
            <div v-for="(whbook,index) in wholebook " :key="index">
                <div class="wholelist-alignTop" style="flex-wrap: wrap;" >
                        <div class="wholelist-collection" :style="{'background':'linear-gradient(to top, rgba(35, 67, 135, 0.3) 35%, rgb(35, 67, 135) 69%) center top / auto no-repeat, url('+whbook.image+') center center / cover no-repeat'}" >
                            <div class=""  @click="goBookCollection(whbook.id)" style="display: block; box-sizing: border-box; width: 100%; height: 100%; padding: 16px; position: relative;" >
                                <span class="wholelist-inner">
                                    <h3 style="font-size: 18px; font-weight: 600;">{{whbook.name}}</h3>
                                    <span class="wholelist-Text" style="vertical-align: middle; font-size: 12.5px;">
                                        <span class="wholelist--pe">{{whbook.recommendCount}}</span>人推荐了
                                        <span class="  wholelist--ps Text--pe">{{whbook.bookCount}}</span>本书
                                    </span>
                                    <div class="Flex" style="position: absolute; bottom: 16px; right: 16px; flex-flow: row-reverse;" v-for="(user,index) in whbook.users" :key="index">
                                        
                                        <span class="wholelist-avatar" >
                                            <span class="wholelist-root">
                                                <img alt="" :src="'https://images.weserv.nl/?url='+(user.headerImg || "")" class="wholelist-boos">
                                            </span>
                                        </span>
                                        <!-- v-bind="{to:'/details?'+whbook.id}" -->
                                    </div>
                                </span>
                            </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="tabbar">
            <router-link to="/" class="active">
                <svg viewBox="0 0 46 46" class="Nav-svg" width="22px" style="fill:rgb(24, 195, 170)">
                <path
                    d="M40.408626,19.0936037 C41.5142794,19.0936037 41.7818872,18.4605103 40.999899,17.6798584 C40.999899,17.6798584 40.2374609,16.8932902 39.3786323,16.1092182 L28.307135,6.00143742 C25.3835998,3.33238081 20.5250347,3.33332761 17.6025366,6.00143742 L6.53103934,16.1092182 C5.27063301,17.2599127 4.94536401,17.5976819 4.94536401,17.5976819 C4.15404803,18.3630748 4.40272061,18.9835484 5.51069352,18.9835484 L8.12933604,18.9835484 L8.12933604,38.9782179 C8.12933604,40.6506196 9.44018899,42 11.0589093,42 L15.1960178,42 L15.1960178,36.1142596 C15.1960178,33.3521692 17.3690855,31.1184079 20.0602903,31.1184079 L25.9028188,31.1184079 C28.5876179,31.1184079 30.7670913,33.3503112 30.7670913,36.1142596 L30.7670913,42 L34.4156598,42 C36.0394895,42 37.3452331,40.6533202 37.3452331,38.9782179 L37.3452331,19.0936037 L40.408626,19.0936037 Z M28.9248518,45 L17.5567028,45 L11.0589093,45 C7.82972191,45 5.21194826,42.3082595 5.21194826,38.9782179 L5.21194826,21.9835484 C-0.845715653,22.0536625 0.249139206,17.8325867 4.5941418,13.8657941 L15.665639,3.75801332 C19.6913513,0.0827185006 26.2138163,0.0786065279 30.2440326,3.75801332 L41.3155298,13.8657941 C45.7999206,17.9598419 47.0068349,21.9607063 40.2626209,22.0536625 L40.2626209,38.9782179 C40.2626209,42.3039563 37.6567593,45 34.4156598,45 L28.9248518,45 Z M27.8497036,42 L27.8497036,36.1142596 C27.8497036,35.0088943 26.9780536,34.1184079 25.9028188,34.1184079 L20.0602903,34.1184079 C18.9774371,34.1184079 18.1134056,35.0119812 18.1134056,36.1142596 L18.1134056,42 L27.8497036,42 Z"
                />
                </svg>
                <div class="text">首页</div>
            </router-link>
            <router-link to="/sell">
                <svg viewBox="0 0 46 46" class="Nav-svg" width="22px" style="fill:rgb(102, 102, 102)">
                <path
                    d="M19,45 L7.00532266,45 C3.67643992,45 1,42.3124666 1,38.9972261 L1,7.00277388 C1,3.68616253 3.68867454,1 7.00532266,1 L19,1 L38.9944332,1 C42.3074511,1 44.9946773,3.68753341 44.9946773,7.00277388 L44.9946773,38.9972261 C44.9946773,42.3138375 42.3082765,45 38.9944332,45 L19,45 Z M6.99467734,4.00001841 C5.33892147,4.00574691 4,5.34742752 4,7.00277388 L4,38.9972261 C4,40.6569606 5.33248781,41.994294 6.99467734,41.9999818 L6.99467734,4.00001709 Z M9.99467734,42 L38.9944332,42 C40.6517185,42 41.9946773,40.6566869 41.9946773,38.9972261 L41.9946773,7.00277388 C41.9946773,5.34445361 40.6506626,4 38.9944332,4 L9.99467734,4 L9.99467734,42 Z M15.9946773,11.0085302 C15.9946773,9.8992496 16.8928897,9 17.9854725,9 L34.0038822,9 C35.103368,9 35.9946773,9.90195036 35.9946773,11.0085302 L35.9946773,18.9914698 C35.9946773,20.1007504 35.096465,21 34.0038822,21 L17.9854725,21 C16.8859867,21 15.9946773,20.0980496 15.9946773,18.9914698 L15.9946773,11.0085302 Z M18.9946773,18 L32.9946773,18 L32.9946773,12 L18.9946773,12 L18.9946773,18 Z"
                />
                </svg>
                <div class="text">卖书</div>
            </router-link>
            <a href="/cart">
                <svg viewBox="0 0 46 46" class="Nav-svg" width="22px" style="fill:rgb(102, 102, 102)">
                <path
                    d="M5.13634582,14.9000848 C4.99035474,14.4862269 4.60514195,12.5971561 3.75482474,7.77983331 C2.83501781,3.52910793 4.43253177,0.5 8.76864821,0.5 L20.2546528,0.5 C21.0831633,0.5 21.7548039,1.17157288 21.7548039,2 C21.7548039,2.82842712 21.0831633,3.5 20.2546528,3.5 L8.76864821,3.5 C6.67624454,3.5 6.12473309,4.54574216 6.69830817,7.2015831 C6.81046467,7.83616231 6.91540462,8.42422373 7.01338927,8.96769281 C8.25306859,7.72925282 10.0046811,6.97740113 12.0370705,6.97740113 L33.2099771,6.97740113 C37.6256869,6.97740113 40.715656,10.5215446 40.1103966,14.9022962 L38.5838965,25.9508111 C37.9791832,30.3276098 33.9027269,33.8757062 29.4825248,33.8757062 L15.7645229,33.8757062 C11.3426874,33.8757062 7.26841058,30.3315627 6.66315116,25.9508111 L5.13665105,14.9022962 C5.1365492,14.901559 5.13644746,14.9008219 5.13634582,14.9000848 Z M10.5160122,46.5 C7.63321442,46.5 5.29950051,44.1540314 5.29950051,41.2641243 C5.29950051,38.3742171 7.63321442,36.0282486 10.5160122,36.0282486 C13.3988099,36.0282486 15.7325238,38.3742171 15.7325238,41.2641243 C15.7325238,44.1540314 13.3988099,46.5 10.5160122,46.5 Z M10.5160122,43.5 C11.738193,43.5 12.7322217,42.5007515 12.7322217,41.2641243 C12.7322217,40.0274971 11.738193,39.0282486 10.5160122,39.0282486 C9.29383135,39.0282486 8.29980262,40.0274971 8.29980262,41.2641243 C8.29980262,42.5007515 9.29383135,43.5 10.5160122,43.5 Z M36.2175797,46.5 C33.334782,46.5 31.0010681,44.1540314 31.0010681,41.2641243 C31.0010681,38.3742171 33.334782,36.0282486 36.2175797,36.0282486 C39.1003775,36.0282486 41.4340914,38.3742171 41.4340914,41.2641243 C41.4340914,44.1540314 39.1003775,46.5 36.2175797,46.5 Z M36.2175797,43.5 C37.4397606,43.5 38.4337893,42.5007515 38.4337893,41.2641243 C38.4337893,40.0274971 37.4397606,39.0282486 36.2175797,39.0282486 C34.9953989,39.0282486 34.0013702,40.0274971 34.0013702,41.2641243 C34.0013702,42.5007515 34.9953989,43.5 36.2175797,43.5 Z M9.63522588,25.540262 C10.0351674,28.434962 12.839098,30.8757062 15.7645229,30.8757062 L29.4825248,30.8757062 C32.4053871,30.8757062 35.2122993,28.4319287 35.6118218,25.540262 L37.1383219,14.491747 C37.4943309,11.9150223 35.8065182,9.97740113 33.2099771,9.97740113 L12.0370705,9.97740113 C9.44255541,9.97740113 7.75307191,11.9175926 8.10872577,14.491747 L9.63522588,25.540262 Z"
                />
                </svg>
                <div class="text">购物车</div>
            </a>
            <a href="/users">
                <svg viewBox="0 0 46 46" class="Nav-svg" width="22px" style="fill:rgb(102, 102, 102)">
                <path
                    d="M11.6315789,12.2340426 C11.6315789,6.02965217 16.7213944,1 23,1 C29.2786056,1 34.3684211,6.02965217 34.3684211,12.2340426 C34.3684211,14.606682 33.624088,16.807528 32.3535828,18.6209987 C31.9895904,19.1405475 30.4160066,20.7629038 30.0271608,21.0654554 C30.5085498,21.1734693 32.4831837,21.786603 33.2739699,22.1670846 C37.8735453,24.3077079 41,28.5097261 41,33.3461158 L41,41.0382649 C41,43.2262708 39.2147544,45 36.9924916,45 L9.0075084,45 C6.79422262,45 5,43.2300258 5,41.0382649 L5,33.3461158 C5,28.510965 8.12452331,24.3075795 12.7255583,22.1666081 C13.2504333,21.9223712 15.4911714,21.1731971 15.9725564,21.0652353 C15.5837584,20.7627014 14.2475509,19.4541476 13.6461576,18.6206281 C12.3758106,16.8072282 11.6315789,14.6065204 11.6315789,12.2340426 Z M16.6375368,23.9605999 C11.5267967,25.1068021 8.00451128,28.9924967 8.00451128,33.3461158 L8.00451128,41.0382649 C8.00451128,41.5888298 8.45208633,42.031003 9.0075084,42.031003 L36.9924916,42.031003 C37.5509942,42.031003 37.9954887,41.5909045 37.9954887,41.0382649 L37.9954887,33.3461158 C37.9954887,28.9928112 34.4721141,25.1073846 29.3618806,23.9607527 L23.2204185,22.5827343 L28.1684742,18.732771 C30.1738544,17.1724329 31.3639098,14.8031405 31.3639098,12.2340426 C31.3639098,7.66938392 27.6192598,3.96899696 23,3.96899696 C18.3807402,3.96899696 14.6360902,7.66938392 14.6360902,12.2340426 C14.6360902,14.8030485 15.8260593,17.1722646 17.8313174,18.7326089 L22.779701,22.583077 L16.6375368,23.9605999 Z"
                />
                </svg>
                <div class="text">我的</div>
            </a>
        </div>
    </div>
</template>
<script>
import axios from "axios";
export default {
    name:'Wholelist',
    data(){
        return{
            wholebook:[],
            page:{
               index:1,
               size:'',
               total:'',
               totalPage:'' ,
            }
        }
        
    },created(){
        this.recommend();
    },mounted() {
        this.$nextTick(function() {
        window.addEventListener("scroll", this.onScroll);
        });
    },methods:{
        goBookCollection(id){
            this.$router.push({path: "/details", query: {id: id}})
        },
        async recommend(){
            await axios.get("/book/collection?isLimit=0&pageSize=6&page="+this.page.index)
                .then(res => {
                    // this.wholebook = res.data.data;
                    if(this.page.index <= res.data.pager.index){
                        console.info(this.page, res.data.pager);
                        console.info(res.data.data);
                        this.wholebook = this.wholebook.concat(res.data.data)   
                    }
                    this.page = res.data.pager;
                });
            console.info(this.wholebook);
            
            
        },
         // 获取滚动条当前的位置
        getScrollTop() {
        let scrollTop = 0;
            if (document.documentElement && document.documentElement.scrollTop) {
                scrollTop = document.documentElement.scrollTop;
            } else if (document.body) {
                scrollTop = document.body.scrollTop;
            }
            return scrollTop;
        },
        // 获取当前可视范围的高度
        getClientHeight() {
            let clientHeight = 0;
            if (document.body.clientHeight && document.documentElement.clientHeight) {
                clientHeight = Math.min(
                document.body.clientHeight,
                document.documentElement.clientHeight
                );
            } else {
                clientHeight = Math.max(
                document.body.clientHeight,
                document.documentElement.clientHeight
                );
            }
            return clientHeight;
        },
        // 获取文档完整的高度
        getScrollHeight() {
            return Math.max(
                document.body.scrollHeight,
                document.documentElement.scrollHeight
            );
        },
        onScroll() {
            if (
                this.getScrollHeight() - this.getClientHeight() - this.getScrollTop() <=
                0
            ) {
                if (this.page.index < this.page.total) {
                this.page.index += 1; //每次加载1条数据
                this.recommend();
                }
            }
        }
    }
}
</script>
<style lang="scss" >
    @import "../../assets/scss/home/Wholelist.scss";
    @import "../../assets/scss/home/home.scss";
</style>